{"version":3,"file":"airburst.min.js","sources":["../../airburst-database/src/airburst-create-database.ts","../../airburst-database/src/airburst-database.ts","../src/airburst.ts","../src/server/app.ts"],"sourcesContent":["import knex from \"knex\";\r\n\r\ntype DataType = \"increment\" | \"string\" | \"integer\" | \"uinteger\" | \"text\" | \"boolean\";\r\n\r\nexport type Column = {\r\n    type?: \"primary\" | \"unique\",\r\n    data: DataType,\r\n    ref?: {\r\n        table: string,\r\n        column: string;\r\n    }\r\n} | DataType;\r\n\r\nexport function createTableIfNoExist(db: knex<any, unknown[]>, name: string, callback: (newTable: knex.TableBuilder) => void) {\r\n    return new Promise((resolve, reject) => {\r\n        db.schema.hasTable(name).then(isExist => {\r\n            if(isExist) return resolve(\"Table already exist\");\r\n            db.schema.createTable(name, newTable => callback(newTable)).then(() => {\r\n                resolve(\"Table created\")\r\n            });\r\n        })\r\n    }) as Promise<string>\r\n}\r\n\r\nexport function createColumnsIfNoExist(table: knex.TableBuilder, name: string, column: Column) {\r\n    if(typeof column == \"string\")\r\n        return addColumnByType(table, name, column);\r\n    \r\n    let col = addColumnByType(table, name, column.data);\r\n    \r\n    if(column.type && column.type == \"primary\") {\r\n        col = col.primary();\r\n    } else if(column.type && column.type == \"unique\") {\r\n        col = col.unique();\r\n    }\r\n\r\n    if(column.ref) {\r\n        table.foreign(name).references(column.ref.column).inTable(column.ref.table)\r\n    }\r\n}\r\n\r\nfunction addColumnByType(table: knex.TableBuilder, name: string, type: DataType) {\r\n    switch(type) {\r\n        case \"increment\": return table.increments(name);\r\n        case \"boolean\": return table.boolean(name);\r\n        case \"integer\": return table.integer(name);\r\n        case \"string\": return table.string(name);\r\n        case \"text\": return table.text(name);\r\n        case \"uinteger\": return table.integer(name).unsigned();\r\n    }\r\n}","import knex from \"knex\";\r\nimport Bookshelf from \"bookshelf\";\r\nimport { createTableIfNoExist, Column, createColumnsIfNoExist } from \"./airburst-create-database\";\r\n\r\ninterface IDatabase {\r\n    [x: string]: {\r\n        [x: string] : Column\r\n    }\r\n}\r\n\r\ninterface ISample {\r\n    table: string;\r\n    data: {[x: string]: string}[]\r\n}\r\n\r\nexport async function createNewDatabase(db: knex<any, unknown[]>, databaseJSON: IDatabase) {\r\n    await createTableIfNoExist(db, \"roles\", newTable => {\r\n        newTable.increments(\"id\");\r\n        newTable.string(\"name\");\r\n        newTable.string(\"description\");\r\n    });\r\n    await createTableIfNoExist(db, \"users\", newTable => {\r\n        newTable.increments(\"id\");\r\n        newTable.string(\"name\");\r\n        newTable.string(\"password\");\r\n        newTable.string(\"description\");\r\n        newTable.integer(\"role_id\").unsigned();\r\n        newTable.foreign(\"role_id\").references(\"id\").inTable(\"roles\");       \r\n    });\r\n    await asyncForEachCustomTables(db, Object.entries(databaseJSON))\r\n}\r\n\r\nasync function asyncForEachCustomTables(db: knex<any, unknown[]>, entries: [string, { [x: string]: Column; }][]) {\r\n        for(let i = 0; i < entries.length; i++) {\r\n            const [key, value] = entries[i];\r\n            await createTableIfNoExist(db, key, newTable => {\r\n                Object.keys(value).forEach((column) => {\r\n                    createColumnsIfNoExist(newTable, column, value[column])\r\n                })\r\n            });\r\n        }\r\n}\r\n\r\nexport async function generateSampleDatabase(db: knex<any, unknown[]>, sample: ISample[]) {\r\n    sample.forEach(async (singleSample) => {\r\n        await populateSampleData(db, singleSample)\r\n    })\r\n}\r\n\r\nasync function populateSampleData(db: knex<any, unknown[]>, sample: ISample) {\r\n    const rowLength = (await db(sample.table)).length;\r\n    if(rowLength > 0) return;\r\n    db(sample.table).insert(sample.data)\r\n}\r\n","import knex from \"knex\";\r\nimport fs from \"fs\";\r\nimport Path from \"path\";\r\nimport Process from \"process\"\r\nimport { createNewDatabase, generateSampleDatabase } from \"airburst-database\";\r\n\r\nfunction connectDatabase() {\r\n    const connectionJson = fs.readFileSync(Path.resolve(__dirname, \"./config/connection.json\"), { encoding: \"utf8\" });\r\n    const json = JSON.parse(connectionJson);\r\n    const database = json.database;\r\n    return knex({\r\n        client: database.driver,\r\n        version: database.version,\r\n        connection: {\r\n            host: database.host,\r\n            user: database.user,\r\n            password: database.password,\r\n            database: database.database,\r\n            filename: database.filename\r\n        }\r\n    })\r\n}\r\n\r\nfunction loadCustomDatabase() {\r\n    const databaseJson = fs.readFileSync(Path.resolve(__dirname, \"./config/database.json\"), { encoding: \"utf8\" });\r\n    const json = JSON.parse(databaseJson);\r\n    return json;\r\n}\r\n\r\nfunction loadSampleData() {\r\n    const sampleJson = fs.readFileSync(Path.resolve(__dirname, \"./config/sample.json\"), { encoding: \"utf8\" });\r\n    const json = JSON.parse(sampleJson);\r\n    return json;    \r\n}\r\n\r\nexport async function initalizeDatabase() {\r\n    let db = connectDatabase();\r\n    await createNewDatabase(db, loadCustomDatabase());\r\n    await generateSampleDatabase(db, loadSampleData());\r\n}","import express from \"express\";\r\nimport jwt from \"express-jwt\";\r\nimport { buildSchema }  from \"graphql\";\r\nimport graphql from \"express-graphql\";\r\nimport { initalizeDatabase } from \"../airburst\";\r\n\r\ninitalizeDatabase();\r\n\r\nconst app = express();\r\n\r\n\r\n//app.use(jwt({ secret: \"lol\" }).unless({ path: [\"/auth\"] }));\r\n\r\napp.use(\"/api/get\", graphql({\r\n    schema: buildSchema(`\r\n        type Query {\r\n            hello: String\r\n        }\r\n    `),\r\n    graphiql: true,\r\n    rootValue: {\r\n        hello: () => \"Hello world\"\r\n    }\r\n}))\r\n\r\napp.listen(3000, () => {\r\n    console.log(\"ðŸš€ Listening...\")\r\n})"],"names":["graphql","buildSchema"],"mappings":"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"}